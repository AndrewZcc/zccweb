{% extends 'base.html' %}

{% block title %}诗歌{% endblock %}

{% block link %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='user-defined/css/poetry.css') }}">
{% endblock %}

{% block sidebar %}
    <li class="active">
        <a href="#">现代诗</a>
    </li>
    <li>
        <a href="#">宋词</a>
    </li>
    <li>
        <a href="#">唐诗</a>
    </li>
    <li>
        <a href="#">古诗</a>
    </li>
{% endblock %}

{% block content %}
    <div class="page-content">
        {% for cat in cat_list %}
            {% set poetries = poetries_list[loop.index0] %}
            {% if poetries %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{{ cat.name }}</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-hover" style="width: 80%; margin-left: 50px;" >
                        <thead>
                        <tr>
                            <th width="20px">序号</th>
                            <th width="100px">标题</th>
                            <th width="1px">诗人</th>
                            <th width="2px">时间</th>
                            <th width="1px">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {%- for poetry in poetries -%}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>
                                <a href="{{ url_for('main.poetry_detail', poetry_id=poetry.id) }}" target="_blank">{{ poetry.title }}</a>
                            </td>
                            <td>{{ poetry.poet.name }}
                                {% if poetry.poet.state %}
                                ({{ poetry.poet.state }})
                                {%- endif -%}
                            </td>
                            <td>{{ poetry.create_time }}</td>
                            <td>
                                {% if poetries_list|length > 1 %}
                                    {% set catid_local = -1 %}
                                {% else %}
                                    {% set catid_local = cat.id %}
                                {% endif %}
                                <div style="float: left">
                                    <form action="{{ url_for('main.del_poetry', cat_id=catid_local, poetry_id=poetry.id) }}" method="POST">
                                        <button type="submit" class="btn-danger">删除</button>
                                    </form>
                                </div>
                                <div style="float: left; margin-left: 10px;">
                                    <form action="{{ url_for('main.edit_doc', cat_id=catid_local, poetry_id=poetry.id) }}" method="GET">
                                        <button type="submit" class="btn-success">编辑</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {%- endfor -%}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block jsscript %}
    <script src="{{ url_for('static', filename='user-defined/js/poetry.js') }}" type="text/javascript"></script>
{% endblock %}